/*
@@copyright@@
*/
!function(e,t){if(void 0!==wp.media.view.roboWpGallery){console.log("Robo Gallery already defined");return!1}var i=wp.media.view.MediaFrame.Select,a=wp.media.controller.Library,r=wp.media.view.l10n;wp.media.view.roboWpGallery=i.extend({initialize:function(){this.counts={audio:{count:wp.media.view.settings.attachmentCounts.audio,state:"playlist"},video:{count:wp.media.view.settings.attachmentCounts.video,state:"video-playlist"}};t.defaults(this.options,{multiple:!0,editing:!0,state:"insert",metadata:{}});i.prototype.initialize.apply(this,arguments);this.createIframeStates()},createStates:function(){var e=this.options;this.states.add([new a({id:"insert",title:r.insertMediaTitle,priority:20,toolbar:"main-insert",filterable:"all",library:wp.media.query(e.library),multiple:e.multiple?"reset":!1,editable:!1}),new a({id:"gallery",title:r.createGalleryTitle,priority:40,toolbar:"main-gallery",filterable:"uploaded",multiple:"add",editable:!0,library:wp.media.query(t.defaults({type:"image"},e.library))}),new wp.media.controller.EditImage({model:e.editImage}),new wp.media.controller.GalleryEdit({library:e.selection,editing:e.editing,menu:"gallery",multiple:!0,displaySettings:!1,displayUserSettings:!1}),new wp.media.controller.GalleryAdd({multiple:"add",editable:!0})])},bindHandlers:function(){var e;i.prototype.bindHandlers.apply(this,arguments);this.on("activate",this.activate,this);if(void 0!==t.find(this.counts,function(e){return 0===e.count}))this.listenTo(wp.media.model.Attachments.all,"change:type",this.mediaTypeCounts);this.on("menu:create:gallery",this.createMenu,this);this.on("toolbar:create:main-insert",this.createToolbar,this);this.on("toolbar:create:gallery-add",this.createToolbar,this);this.on("toolbar:create:main-gallery",this.createToolbar,this);this.on("toolbar:create:main-embed",this.mainEmbedToolbar,this);e={menu:{default:"mainMenu",gallery:"galleryMenu"},content:{embed:"embedContent","edit-image":"editImageContent","edit-selection":"editSelectionContent"},toolbar:{"main-insert":"mainInsertToolbar","main-gallery":"mainGalleryToolbar","gallery-edit":"galleryEditToolbar","gallery-add":"galleryAddToolbar"}};t.each(e,function(e,i){t.each(e,function(e,t){this.on(i+":render:"+t,this[e],this)},this)},this)},activate:function(){t.each(this.counts,function(e){if(e.count<1)this.menuItemVisibility(e.state,"hide")},this)},mediaTypeCounts:function(e,t){if(void 0!==this.counts[t]&&this.counts[t].count<1){this.counts[t].count++;this.menuItemVisibility(this.counts[t].state,"show")}},mainMenu:function(e){},menuItemVisibility:function(e,t){var i=this.menu.get();if("hide"===t)i.hide(e);else if("show"===t)i.show(e)},galleryMenu:function(e){var t=this.lastState(),i=t&&t.id,a=this;e.set({cancel:{text:r.cancelGalleryTitle,priority:20,click:function(){if(i)a.setState(i);else a.close();this.controller.modal.focusManager.focus()}},separateCancel:new wp.media.View({className:"separator",priority:40})})},embedContent:function(){var e=new wp.media.view.Embed({controller:this,model:this.state()}).render();this.content.set(e)},editSelectionContent:function(){var e,t=this.state(),i=t.get("selection");(e=new wp.media.view.AttachmentsBrowser({controller:this,collection:i,selection:i,model:t,sortable:!0,search:!1,date:!1,dragInfo:!0,AttachmentView:wp.media.view.Attachments.EditSelection}).render()).toolbar.set("backToLibrary",{text:r.returnToLibrary,priority:-100,click:function(){this.controller.content.mode("browse");this.controller.modal.focusManager.focus()}});this.content.set(e);this.trigger("edit:selection",this)},editImageContent:function(){var e=this.state().get("image"),t=new wp.media.view.EditImage({model:e,controller:this}).render();this.content.set(t);t.loadEditor()},selectionStatusToolbar:function(e){var t=this.state().get("editable");e.set("selection",new wp.media.view.Selection({controller:this,collection:this.state().get("selection"),priority:-40,editable:t&&function(){this.controller.content.mode("edit-selection")}}).render())},mainInsertToolbar:function(e){var t=this;this.selectionStatusToolbar(e);e.set("insert",{style:"primary",priority:80,text:r.insertIntoPost,requires:{selection:!0},click:function(){var e=t.state(),i=e.get("selection");t.close();e.trigger("insert",i).reset()}})},mainGalleryToolbar:function(e){var t=this;this.selectionStatusToolbar(e);e.set("gallery",{style:"primary",text:r.createNewGallery,priority:60,requires:{selection:!0},click:function(){var e=t.state().get("selection"),i=t.state("gallery-edit"),a=e.where({type:"image"});i.set("library",new wp.media.model.Selection(a,{props:e.props.toJSON(),multiple:!0}));this.controller.setState("gallery-edit");this.controller.modal.focusManager.focus()}})},galleryEditToolbar:function(){var e=this.state().get("editing");this.toolbar.set(new wp.media.view.Toolbar({controller:this,items:{insert:{style:"primary",text:e?r.updateGallery:r.insertGallery,priority:80,requires:{library:!0},click:function(){var e=this.controller,t=e.state();e.close();t.trigger("update",t.get("library"));e.setState(e.options.state);e.reset()}}}}))},mainInsertToolbar:function(e){var t=this;this.selectionStatusToolbar(e);e.set("insert",{style:"primary",priority:80,text:r.insertIntoPost,requires:{selection:!0},click:function(){var e=t.state(),i=e.get("selection");t.close();e.trigger("insert",i).reset()}})},galleryAddToolbar:function(e){this.selectionStatusToolbar(e);e.set("insert",{style:"primary",text:r.addToGallery,priority:80,requires:{selection:!0},click:function(){var e=this.controller,t=e.state();e.state("gallery-edit").get("library").add(t.get("selection").models);t.trigger("reset");e.setState("gallery-edit");this.controller.modal.focusManager.focus()}})}})}(jQuery,_);